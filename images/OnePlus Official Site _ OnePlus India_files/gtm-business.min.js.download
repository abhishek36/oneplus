!function(){"use strict";var e,t=document.querySelectorAll.bind(document),n=window.dataLayer=window.dataLayer||[],r="",a="",o=1e4;function c(){a=document.getElementById("mark-currency-code")?document.getElementById("mark-currency-code").value:"",document.getElementById("order-data")?document.getElementById("order-data").value:"",r=function(){var e=location.pathname.split("/").concat([]).pop(),t="";window.isHome?t="home":/www.+\/store\/all($|\?)/.test(location.href)?t="store":/www.+\/store\/phone($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/tv($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/power-cables($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/cases-protection($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/audio($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/bundles($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/gear($|\?)/.test(location.href)?t="storeProduct":/www.+\/store\/wearables($|\?)/.test(location.href)?t="storeProduct":"jcart"===e?t="jcart":"onepage"===e?t="checkout":location.pathname.indexOf("jcart/falcon/success")>=0||location.pathname.indexOf("order/success")>=0?t="paymentSuccess":location.pathname.indexOf("sales/order/history")>=0&&location.search.indexOf("payment_status=error")>=0?t="paymentFail":0===e.indexOf("oneplus-")&&document.getElementById("data-device")?t="phoneModels":document.getElementById("data-recom")?t="accessoryDetail":/www.+\/transaction\/pay($|\?)/.test(location.href)?t="cashRegister":/\/transaction\/pay($|\?)/.test(location.href)?t="cashRegister":location.pathname.indexOf("payment/guest-success")>=0&&(t="visitorPaymentSuccess");return t}();try{!function(){switch(r){case"home":!function(e){var t=document.querySelector(".op-narrow-banner")&&document.querySelector(".op-narrow-banner").querySelectorAll(".banner-column .banner-button, .banner-column .learn-more"),n=document.querySelector(".op-home-promo")&&document.querySelector(".op-home-promo").querySelectorAll(".promo-item .item-link");if(t)var r=Array.prototype.filter.call(t,function(e){return e.innerText.trim()}).map(function(t){var n=t.getAttribute("promocr"),r=t.href,a=r+" | "+t.innerText,c=o(r),i={id:a,name:c,creative:n,position:t.getAttribute("promops")};return t.setAttribute("promonm",c),t.addEventListener("click",function(){e.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[i]}}})}),i});if(n)var a=Array.prototype.map.call(n,function(t){var n=t.getAttribute("promocr"),r=t.href,a=r+" | "+t.querySelector(".subtitle").innerText,c=o(r),i={id:a,name:c,creative:n,position:t.getAttribute("promops")};return t.setAttribute("promonm",c),t.addEventListener("click",function(){e.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[i]}}})}),i});r&&a&&e.push({event:"loadHome",ecommerce:{promoView:{promotions:r.concat(a)}}});function o(e){var t=e.match(/https:\/\/(.*)\?.*/),n=t&&t[1].split("/").pop()||"";return n||e}}(n);break;case"store":case"storeProduct":u(n);break;case"phoneModels":!function(e){m(function(){var e=t(".price-container .price");return!(!e.textContent||""==e.textContent.trim())},function(){!function(){var n=document.getElementById("data-phone-skus-stats")&&JSON.parse(document.getElementById("data-phone-skus-stats").innerHTML)||[],o=document.getElementById("data-stats")&&JSON.parse(document.getElementById("data-stats").innerHTML).salePrice,c=document.getElementById("data-stats")&&JSON.parse(document.getElementById("data-stats").innerHTML).sku;e.push({event:"loadProductDetail",ecomm_prodid:[c],ecomm_pagetype:"product",ecomm_value:o,ecommerce:{currencyCode:a,detail:{products:n.map(function(e){return{id:e.skuCode,name:e.skuName,price:Number(e.salePrice),category:"Device",dimension1:e.outStock?"Out of Stock":"In Stock"}})}}});var i=location.pathname.split("/").concat([]).pop();e.push({event:"eeEvent",eventCategory:"Store - Product detail page+"+i,eventAction:"Product detail view",eventLabel:"Product detail view",nonInteraction:!0,ecommerce:{detail:{products:n.map(function(e,t){return{id:e.skuCode,name:e.skuName,price:Number(e.salePrice),variant:e.skuName,position:t+1,brand:"OnePlus",category:"Device",dimension1:e.outStock?"Out of Stock":"In Stock"}})}}});var u=document.getElementById("data-device")&&JSON.parse(document.getElementById("data-device").innerHTML).name,s=document.getElementById("data-stats")&&JSON.parse(document.getElementById("data-stats").innerHTML).subtotal;e.push({event:"logEvent",event_name_fb:"view_item",event_params_fb:{current_screen:"Product Details Page+"+u,product_name:u,currency:a,value:s,items:n.map(function(e){return{item_name:u,item_variant:e.skuName,price:Number(e.salePrice),item_category:"Device",item_brand:"OnePlus"}})}}),r();var d=t(".puppet.tab-nav-puppet");Array.prototype.forEach.call(d,function(e){e.addEventListener("click",function(){var t=e.getAttribute("for");"tab-nav-phone"===t&&setTimeout(function(){r()}),"tab-nav-recoms"===t})})}()},o);var n=!1;function r(){var r=t(".product-station__purchase .option-item")||[];function o(n){const r={Color:"Color_Select",Capacity:"Capacity_Select"};var a=t(".option-item.active")||[];(a=n?Array.from(a).filter(e=>e.dataset.attr===n):Array.from(a).filter(e=>"Color"===e.dataset.attr||"Capacity"===e.dataset.attr)).forEach(t=>{e.push({event:"uaEvent",eventCategory:"Product Details Page+"+t.getAttribute("data-name"),eventAction:r[t.getAttribute("data-attr")],eventLabel:t.getAttribute("data-name"),nonInteraction:!1})})}Array.from(r).forEach(e=>{e.addEventListener("click",function(e){var t=d(e.target,".option-item");o(t.getAttribute("data-attr"))})}),o(),!0,function(){n||(r=t(".choose-recoms .js-recom"),Array.prototype.forEach.call(r,function(n){n.addEventListener("click",function(){var n=this.firstElementChild.getAttribute("data-sku"),r=t(".recom-overlay[data-code="+n+"]")[0];if(r){var o=r.querySelector("[data-stock]"),i=r.querySelector(".js-name").textContent,u={id:r.getAttribute("data-code"),name:i&&i.trim(),price:Number(r.getAttribute("data-price")),category:c(r),dimension1:o&&1==o.getAttribute("data-stock")?"In Stock":"Out of Stock"};e.push({event:"popupAccessoryDetail",ecommerce:{currencyCode:a,detail:{products:u}}})}})}),n=!0);var r;o=t(".recom-overlay .btn-add-to-cart")||[],Array.prototype.forEach.call(o,function(t){t.addEventListener("click",function(t){var n=d(t.target,".recom-overlay"),r=n&&n.querySelector(".header-container .title").textContent;e.push({event:"addAccessory",model:r})})}),!0;var o}()}function c(e){if(!e)return"";var t="";return e.querySelector(".simple-step")?t="Accessory":e.querySelector(".series-steps")?t="Series":e.querySelector(".bundle-steps")&&(t="Bundle"),t}}(n);break;case"accessoryDetail":!function(e){var n=document.getElementById("data-recom")&&JSON.parse(document.getElementById("data-recom").innerHTML)||null,r=n&&function(e){var t={skus:[]};return e.simple&&(t.name=e.simple.name,t.category="Accessory",t.skus=t.skus.concat(e.simple.sku)),e.series&&e.series.skus&&(t.name=e.series.name,t.category="Series",t.skus=t.skus.concat(e.series.skus.map(function(e){return e.sku}))),e.bundle&&(t.skus=t.skus.concat(e.bundle.sku),t.name=e.bundle.name,t.category="Bundle"),t}(n)||[];function c(){var e=t(".recom-overlay")[0];return e?Number(t(".recom-overlay")[0].getAttribute("data-price")):0}m(function(){return c()>0},function(){!function(n){var o=document.querySelector(".btn-add-to-cart");o&&o.addEventListener("click",function(){var o="";o=n&&n.simple?document.querySelector(".simple-step .behind-stage-input").value:document.querySelector(".sku-step .behind-stage-input:checked").value;var i=c(),u=t(".recom-overlay .js-name")[0].textContent;e.push({event:"addProdToCart",ecomm_prodid:[o],ecomm_value:i,ecommerce:{currencyCode:a,add:{products:[{name:u&&u.trim(),id:o,price:i,quantity:1,category:r.category,dimension1:"In Stock"}]}}})}),e.push({ecomm_pagetype:"accessory detail",ecomm_prodid:r.skus,ecomm_value:c(),ecomm_category:["Accessory"]}),e.push({event:"loadProductDetail",ecomm_prodid:r.skus,ecomm_value:c(),ecommerce:{currencyCode:a,detail:{products:function(e){var n;return e&&e.series?Array.prototype.map.call(t(".behind-stage .behind-stage-input"),function(e){return{name:e.getAttribute("data-name"),id:e.getAttribute("data-sku"),price:e.getAttribute("data-price"),category:r.category,dimension1:1==e.getAttribute("data-stock")?"In Stock":"Out of Stock"}}):(n=c(),[{name:r.name,id:r.skus&&r.skus[0],price:n,category:r.category,dimension1:n.length>0?"In Stock":"Out of Stock"}])}(n)}}});var i=location.pathname.split("/").concat([]).pop();e.push({event:"eeEvent",eventCategory:"Store - Product detail page+"+i,eventAction:"Product detail view",eventLabel:"Product detail view",nonInteraction:!1,ecommerce:{detail:{products:function(e){var n;return e&&e.series?Array.prototype.map.call(t(".behind-stage .behind-stage-input"),function(e){return{name:e.getAttribute("data-name"),id:e.getAttribute("data-sku"),price:e.getAttribute("data-price"),variant:e.getAttribute("data-name"),position:"",brand:"OnePlus",category:r.category,dimension1:1==e.getAttribute("data-stock")?"In Stock":"Out of Stock"}}):(n=c(),[{name:r.name,id:r.skus&&r.skus[0],price:n,variant:r.name,position:"",brand:"OnePlus",category:r.category,dimension1:n.length>0?"In Stock":"Out of Stock"}])}(n)}}})}(n)},o)}(n);break;case"jcart":!function(e){function n(){var n=[{selector:".num-minus",action:"minus"},{selector:".num-add",action:"add"},{selector:".ico-remove",action:"remove"},{selector:".edit-checkbox",action:"select"}];t(".cart-items")[0].addEventListener("click",function(t){var r=t.target;n.forEach(function(t){if(r.matches(t.selector)){var n=r.classList.contains("disabled");if(!n){var o=d(r,".product-list");if(r.classList.contains("edit-checkbox")&&!r.checked)return;!function(t,n,r){var o=c().reduce(function(e,t){return e+t.price*t.quantity},0);if(n){var u=i(n),s=Array.prototype.indexOf.call(document.querySelectorAll(".cart-items .product-list"),n)+1,d=u;switch(d.name=d.name.split("<br>")[0].trim(),d.variant=d.name,d.position=s,delete d.dimension1,t){case"add":u.quantity=r||1,e.push({event:"cartIncrease",ecommerce:{currencyCode:a,add:{products:[u]}}}),d.quantity=1,e.push({event:"eeEvent",eventCategory:"Store - Cart page",eventAction:"add to cart",eventLabel:d.name,nonInteraction:!1,ecommerce:{currencyCode:a,add:{products:[d]}}}),e.push({event:"logEvent",event_name_fb:"add_to_cart",event_params_fb:{current_screen:"Cart Page",product_name:u.name,currency:a,value:u.price,items:[{item_id:u.id,item_name:u.name,item_variant:u.variant,price:u.price,item_category:u.category,item_brand:u.brand,quantity:u.quantity}]}});break;case"minus":u.quantity=r||1,e.push({event:"cartDecrease",ecommerce:{currencyCode:a,remove:{products:[u]}}}),d.quantity=1,e.push({event:"eeEvent",eventCategory:"Store - Cart page",eventAction:"remove from cart",eventLabel:d.name,nonInteraction:!1,ecommerce:{currencyCode:a,remove:{products:[d]}}}),e.push({event:"logEvent",event_name_fb:"remove_from_cart",event_params_fb:{current_screen:"Cart Page",product_name:u.name,currency:a,value:u.price,items:[{item_id:u.id,item_name:u.name,item_variant:u.variant,price:u.price,item_category:u.category,item_brand:u.brand,quantity:u.quantity}]}});break;case"remove":e.push({event:"cartDelete",ecommerce:{currencyCode:a,remove:{products:[u]}}}),e.push({event:"eeEvent",eventCategory:"Store - Cart page",eventAction:"remove from cart",eventLabel:d.name,nonInteraction:!1,ecommerce:{currencyCode:a,remove:{products:[d]}}}),e.push({event:"logEvent",event_name_fb:"remove_from_cart",event_params_fb:{current_screen:"Cart Page",product_name:u.name,currency:a,value:o,items:[{item_id:u.id,item_name:u.name,item_variant:u.variant,price:u.price,item_category:u.category,item_brand:u.brand,quantity:u.quantity}]}});break;case"select":e.push({event:"uaEvent",eventCategory:"Cart page",eventAction:"Cart_Select_Product",eventLabel:d.name,nonInteraction:!1})}}}(t.action,o)}}})})}function r(){var n=t(".recommend-content");Array.prototype.forEach.call(n,function(t){t.addEventListener("click",function(t){!function(t,n){var r=t||window.event,o=r.target||r.srcElement;if(o.matches(".add-to-button")){var c=d(o,n),i=c.getAttribute("data-sku"),u=Number(c.getAttribute("data-price")),m=c.querySelector(".info-name").innerText;e.push({event:"addProdToCart",ecomm_prodid:[i],ecomm_value:u,ecommerce:{currencyCode:a,add:{products:[{id:i,name:m,price:u,quantity:1,dimension1:"In Stock"}]}}}),e.push({event:"eeEvent",eventCategory:"Store - Cart page",eventAction:"You might also like - add to cart",eventLabel:m,nonInteraction:!1,ecommerce:{currencyCode:a,add:{products:[{id:i,name:m,price:u,quantity:1,variant:m,position:"",brand:"OnePlus",category:""}]}}}),e.push({event:"logEvent",event_name_fb:"add_to_cart",event_params_fb:{current_screen:"Cart Page_mightalsolike",product_info:"accessory + "+m,currency:a,items:[{item_id:i,item_name:m,item_variant:m,item_category:s(i)?"Device":"accessory",item_brand:"OnePlus",price:u,quantity:1}]}})}}(t,".recommend-item")})})}function c(){var e,n=t(".cart-items .product-list"),r=Array.prototype.map.call(n,function(e){return i(e)}),a=(e=t(".item-recom"),Array.prototype.map.call(e,function(e){return{id:e.getAttribute("data-sku"),name:e.querySelector(".accessories-name").innerText,price:Number(e.getAttribute("data-price")),category:"Insurance",quantity:Number(e.getAttribute("data-qty")),dimension1:"In Stock"}}));return r.concat(a)}function i(e){var t=e.getAttribute("data-sku"),n=e.querySelector(".main-product .product-main-name")?e.querySelector(".main-product .product-main-name"):e.querySelector(".main-product .main-name .product-text"),r=n.innerText,a=e.querySelectorAll(".product-parameter-item");return Array.prototype.map.call(a,function(e){r+=e.innerText}),r=r.replace(/[\r]/g,"").replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),{id:t,name:r,price:Number(e.querySelector(".main-price .price").getAttribute("data-price")),category:function(e,t){return s(e)?"Device":t.querySelector(".item-recom")?"Device":t.querySelector(".item-detail")?"Bundle":"Accessory"}(t,e),quantity:Number(e.querySelector(".main-qty").getAttribute("data-qty")),dimension1:e.classList.contains("un-sale-product-list")?"Out of Stock":"In Stock",variant:r,position:"",brand:"OnePlus"}}m(function(){return t(".cart-items .product-list").length>0},function(){var o=c(),i=o.map(function(e){return e.category});e.push({event:"cartMktParamsReady",ecomm_pagetype:"cart",ecomm_value:o.reduce(function(e,t){return e+t.price*t.quantity},0),ecomm_prodid:o.map(function(e){return{id:e.id,price:e.price,currency:a,name:e.name,qty:e.quantity}}),ecomm_category:i}),t(".cart-items .product-list").length>0&&(!function(){var n=c(),r=n.reduce(function(e,t){return e+t.price*t.quantity},0);t("#final_checkout")[0].addEventListener("click",function(){try{e.push({event:"logEvent",event_name_fb:"begin_checkout",event_params_fb:{current_screen:"Cart Page",button_name:"Check out",currency:a,value:r,items:n.map(function(e){return{item_id:e.id,item_name:e.name,item_variant:e.variant,price:e.price,item_category:e.category,item_brand:e.brand,quantity:e.quantity}})}}),e.push({event:"eeEvent",eventCategory:"Store - Cart page",eventAction:"Checkout",eventLabel:"Checkout",nonInteraction:!1,ecommerce:{currencyCode:a,checkout:{actionField:{step:1},products:n.map(function(e,t){return e.name=e.name.trim(),e.position=t+1,e})}}})}catch(e){}})}(),n(),r())},o)}(n);break;case"paymentFail":!function(e){var t="";location.search.substring(1).split("&").some(function(e){if("msg"===e.split("=")[0])return t=decodeURIComponent(e.split("=")[1]),!0}),e.push({event:"transactionFailed",purchaseFailedReason:t}),e.push({event:"uaEvent",eventCategory:"Store - Payment page",eventAction:"Payment fail",eventLabel:"Payment fail",nonInteraction:!1}),e.push({event:"logEvent",event_name_fb:"Payment_fail",event_params_fb:{current_screen:"Payment Page",function_name:"Payment fail"}})}(n);break;case"paymentSuccess":case"visitorPaymentSuccess":i(n);break;case"cashRegister":!function(e){var n=[];function r(e,t){return s(e)?"Device":t.querySelector(".item-recom")?"Device":t.querySelector(".item-detail")?"Bundle":"Accessory"}m(function(){return(n=t(".payment-method .payment-item input[type=radio]:checked")).length>0},function(){var o,c,i;!function(){var r=document.getElementById("data-product")&&JSON.parse(document.getElementById("data-product").innerHTML)||null;n&&r&&(n=n[0],e.push({event:"checkoutStep5-paymentMethod",ecommerce:{currencyCode:r.symbol,checkout:{actionField:{step:5,option:n.getAttribute("data-name")},products:r.products}}}));for(let n=0;n<t(".payment-item").length;n++)t(".payment-item>input")[n].addEventListener("click",function(){e.push({event:"eeEvent",eventCategory:"Store - Payment page",eventAction:"Payment method",eventLabel:t(".payment-method .payment-item input[type=radio]:checked")[0].getAttribute("data-name"),nonInteraction:!1,ecommerce:{currencyCode:a,checkout:{actionField:{step:5},products:r&&r.map(function(e,t){return e.id=e.sku,e.price=e.amt,e.quantity=e.qty,e.position=t+1,e.brand="OnePlus",e})}}})})}(),o=document.getElementById("data-product")&&JSON.parse(document.getElementById("data-product").innerHTML)||null,c=document.getElementById("order-data")?document.getElementById("order-data").value:"",i=t(".btn-pay")[0],n&&(n=n[0],i&&i.addEventListener("click",function(u){try{n=t(".payment-method .payment-item input[type=radio]:checked");var s=i.getAttribute("data-conpons"),d=i.getAttribute("data-gastatus");e.push({event:"eeEvent",eventCategory:"Store - Payment page",eventAction:"Pay now",eventLabel:n[0].getAttribute("data-name"),status:d,coupon:s&&s.split&&s.split(",")||[],nonInteraction:!1,ecommerce:{currencyCode:a,checkout:{actionField:{step:6},products:o&&o.map(function(e,t){return e.category=r(e.sku,e),e.variant=e.name,e.id=e.sku,e.price=e.amt,e.quantity=e.qty,e.position=t+1,e.brand="OnePlus",e})}}}),e.push({event:"logEvent",event_name_fb:"Pay_now",event_params_fb:{current_screen:"Payment Page",method:n[0].getAttribute("data-name"),currency:a,value:Number(c),coupon:"",items:o&&o.map(function(e){return{item_id:e.sku,item_name:e.name,item_category:r(e.sku,e),item_variant:e.name,quantity:e.qty,item_brand:"OnePlus",price:Number(e.amt)}})}})}catch(e){console.log(e)}}))},o)}(n);break;case"checkout":!function(e){var n;m(function(){return t(".order-product .product-detail").length>0},function(){var r=t(".order-product .product-detail");n=Array.prototype.map.call(r,function(e,t){var n=e.getAttribute("data-sku"),r=Number(e.getAttribute("data-price")),a=e.getAttribute("data-name"),o=Number(e.getAttribute("data-qty")),c=function(e,t){return s(e)?"Device":t.classList.contains("insurance-item")?"Insurance":t.querySelector(".product-accessories")?"Bundle":"Accessory"}(n,e);return{id:n,name:a&&a.trim(),price:r,category:c,quantity:o,variant:a&&a.trim(),position:t+1,brand:"OnePlus"}}),e.push({event:"checkoutStep2-onePage",ecomm_prodid:n.map(function(e){return e.id}),ecomm_category:n.map(function(e){return e.category}),ecommerce:{currencyCode:a,checkout:{actionField:{step:2,option:"One Page"},products:n}}}),e.push({event:"eeEvent",eventCategory:"Store - Checkout page",eventAction:"Shipping address",eventLabel:"Selected by default",nonInteraction:!1,ecommerce:{currencyCode:a,checkout:{actionField:{step:2},products:n}}})},o),r=t("#shipping-address-confirm")[0],r&&r.addEventListener("click",function(){var r=t("#sp-add-block-main [name=selectedAddress-shipping-address]:checked");r&&(e.push({event:"logEvent",event_name_fb:"Shipping_address_confirm",event_params_fb:{current_screen:"Checkout Page",function_name:"Selected by default"}}),e.push({event:"checkoutStep3-shippingAddress",ecommerce:{currencyCode:a,checkout:{actionField:{step:3,option:"adding"},products:n}}}),e.push({event:"eeEvent",eventCategory:"Store - Checkout page",eventAction:"Shipping address",eventLabel:"Confirm shipping address",nonInteraction:!1,ecommerce:{checkout:{actionField:{step:2},products:n}}}))}),function(){var r=t(".method-list")[0];r&&r.addEventListener("click",function(r){var o=t(".method-item:checked");o&&e.push({event:"eeEvent",eventCategory:"Store - Checkout page",eventAction:"Shipping method",eventLabel:t(".method-item.active .method-title")[0].innerHTML,nonInteraction:!1,ecommerce:{currencyCode:a,checkout:{actionField:{step:3},products:n}}})})}(),function(){var r=t("#btn-falcon-place-order")[0];r&&r.addEventListener("click",function(t){try{var o=t.target.classList.contains("disabled"),c=r.getAttribute("data-conpons"),i=r.getAttribute("data-gastatus");!o&&e.push({event:"CheckoutStep6-placeOrder",ecommerce:{currencyCode:a,checkout:{actionField:{step:6,option:"Place Order"},products:n}}}),!o&&e.push({event:"eeEvent",eventCategory:"Store - Checkout page",eventAction:"Place order",eventLabel:"Place order",status:i,nonInteraction:!1,coupon:c&&c.split&&c.split(",")||[],ecommerce:{currencyCode:a,checkout:{actionField:{step:4},products:n}}})}catch(e){console.log(e)}})}();var r}(n)}}()}catch(e){console.error(e)}}function i(e){let t={getPublicKey:()=>"-----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1vrqv0lHE/b09+J5ANuRAQ4h9dTxKA8r+Xh9A7Np+9cz/8ndKbL+xYj1IEfwg4YH96noeGNZVyeMkrcYlaxJbS2tadumwZ+ZR5LaBvD2njDn16ezRQoYc/hlNd13AZYcj/jtFy4WOVFy/NR1K9Un44q1wYfyNGh8iB1dIeFrAuJhK+wBj3r5tMQOtlnORaAJk4mtS222uvyicyk935bfibFuiw2YCLkWmkb/k0y5Oj3wxfkIJj/7onoPQuxFpCsvdXmHsXD2VIAt4tRnnT7LUPvl7/SgvcPSk2rY3ojoq3zTP87Japg8CoY810flS6soWE6knvbHuCFzSg0ZsiL3ZwIDAQAB-----END PUBLIC KEY-----",encrypt(e){if("undefined"==typeof JSEncrypt)return"";let t=new JSEncrypt;return t.setPublicKey(this.getPublicKey()),t.encrypt(e)}};var n=location.search.substring(1).split("&")[0].split("=")[1];function r(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()}function c(e,t){return s(e)?"Device":"1"===t.isInsurance?"Insurance":t.accessories&&t.accessories.length>0?"Bundle":"Accessory"}function i(e){return e.salePrice*e.qty-(e.discount||0)}m(function(){return!(!window.successOrderData||!window.successOrderData.orderNo)},function(){var o=window.successOrderData;if(o){o.currency||(o.currency=a);var u=[],d=[],m=!1;if(o.tags&&o.tags.length>0)m=-1!==o.tags.indexOf("tourist_order");o.products.forEach(function(e){e.insurance=e.insurance||[];var t=e.insurance.length>0;u.push(e),t&&(d=d.concat(e.insurance))});var p=(u=u.concat(d)).map(function(e){return e.category=c(e.sku,e),e.category}),l=function e(t){return t.some(function(t){return!!s(t.sku)||!!(t.accessories&&t.accessories.length>0)&&e(t.accessories)})}(u),v=u.reduce(function(e,t){var n=0;if(s(t.sku||t.skuCode))n=i(t);else if(t.accessories&&t.accessories.length>0){n=t.accessories.some(function(e){return s(e.sku||e.skuCode)})?i(t):0}return+n+e},0),y=u.reduce(function(e,t){return e+i(t)},0),g=[];!function e(t,n){t.forEach(function(t){if(1===t.skuType){const r=c(t.sku||t.skuCode,t);n.push({id:t.sku||t.skuCode,quantity:t.qty,price:t.salePrice,discount:t.discount||0,name:t.name||t.skuName,category:r,subTotal:i(t)}),t.accessories&&t.accessories.length>0&&e(t.accessories,n)}else 2===t.skuType&&t.accessories&&t.accessories.length>0&&(t.accessories.forEach(function(e){e.category="Accessory"}),e(t.accessories,n))})}(o.products,g),e.push({event:"purchaseMktParamsReady",ecomm_pagetype:"purchase",ecomm_prodid:u.map(function(e){return e.sku||e.skuCode}),ecomm_value:y,ecomm_category:p}),e.push({event:"Transaction",orderType:l?"device":"default",phoneSaleAmount:v,accessorySaleAmount:(y-v).toFixed(2),userEmail:o.email,deliverCountry:o.address&&o.address[0]&&o.address[0].countryCode,estimatedDeliveryDate:o.warehouseInfo&&o.warehouseInfo.etaTime,ecommerce:{currencyCode:o.currency,purchase:{actionField:{id:n,affiliation:r("affiliation")||"",revenue:o.grandTotalPrice,tax:o.taxPrice,shipping:o.shippingPrice},products:u.map(function(e){const t=c(e.sku||e.skuCode,e);return{id:e.sku||e.skuCode,name:e.name||e.skuName,category:t,price:e.salePrice,quantity:e.qty,discount:e.discount||0,subTotal:i(e)}})}},isFirstPaidOrder:window.isFirstPaidOrder||!1,singleItemsList:g||[],coupon:o.couponCodes||[]}),e.push({event:"eeEvent",eventCategory:"Store - Payment page",eventAction:"Payment success",eventLabel:"Payment success",nonInteraction:!1,status:m?"visitor":"",coupon:o.couponCodes||[],ecommerce:{currencyCode:o.currency,purchase:{actionField:{id:t&&t.encrypt(n),affiliation:r("affiliation")||"",revenue:o.grandTotalPrice,tax:o.taxPrice,shipping:o.shippingPrice},products:u.map(function(e,t){return{id:e.sku||e.skuCode,name:e.name||e.skuName,category:e.category,price:e.salePrice-(e.discount||0),quantity:e.qty,discount:e.discount||0,subTotal:i(e),position:t+1,brand:"OnePlus"}})}}}),e.push({event:"logEvent",event_name_fb:"purchase",event_params_fb:{current_screen:"Store - Payment Page",product_name:"",transaction_id:t&&t.encrypt(n),affiliation:r("affiliation")||"",coupon:o.couponCodes,currency:o.currency,value:Number(o.grandTotalPrice),tax:Number(o.taxPrice),shipping:Number(o.shippingPrice),status:m?"visitor":"",items:u.map(e=>({item_id:e.sku||e.skuCode,item_name:e.name||e.skuName,item_variant:e.name||e.skuName,price:Number(e.nowPrice),item_category:e.category,item_brand:"OnePlus",quantity:e.qty}))}})}},o)}function u(e){var n=setInterval(function(){t(".swiper-wrapper .swiper-slide-duplicate-active a").length&&(!function(){var n=t(".swiper-wrapper .swiper-slide-duplicate-active a")[0];let a=Number(t(".swiper-wrapper .swiper-slide-duplicate-active")[0].getAttribute("data-swiper-slide-index")),o=n.getAttribute("promonm")||"",c=n.getAttribute("promocr"),i=n.getAttribute("href");e.push({event:"eeEvent",eventCategory:"store"==r?"Store - Homepage":"Store - Product list page",eventAction:"Top banner view",eventLabel:`img${a+1}+${o}`,nonInteraction:!0,ecommerce:{promoView:{promotions:[{id:`${i}`,name:`${o}`,creative:`${c}`,position:`${a+1}`}]}}})}(),clearInterval(n))},500);var o=setInterval(function(){var n=t(".mo-main-products .mo-main-products-one a"),c=t(".main-products .main-products-one a");(n.length&&n[0].getAttribute("productprice")||c.length&&c[0].getAttribute("productprice"))&&(!function(n){let o=t(".top-products .top-products-one a.top-product"),c=t(n?".mo-main-products .mo-main-products-one":".main-products .main-products-one"),i=n?t(".mo-main-products.right .mo-main-products-one a"):[],u=t(n?".mo-main-products .mo-main-products-one a":".main-products .main-products-one a"),d=[];for(let e=0;e<o.length&&d.length<3;e++)d.push(o[e].getAttribute("sku"));n&&i.length&&d.length<2&&d.push(i[0].getAttribute("sku"));for(let e=0;e<u.length;e++){let t=u[e],n=t.getAttribute("sku");d.push({id:n,name:t.getAttribute("productname"),price:t.getAttribute("productprice"),currency:a,category:(m=n,p=t,s(m)?"Device":p.classList.contains("insurance-item")?"Insurance":p.querySelector(".product-accessories")?"Bundle":"Accessory")})}var m,p;e.push({event:"dynRmktParamsReady",ecomm_prodid:d});for(let t=0;t<c.length;t++)u[t].addEventListener("click",function(){let n=Number(c[t].getAttribute("position")),o=u[t].getAttribute("productname"),i=u[t].getAttribute("sku"),s=Number(u[t].getAttribute("productprice"));e.push({event:"eeEvent",eventCategory:"store"==r?"Store - Homepage":"Store - Product list page",eventAction:"Product entry click",eventLabel:`img${n+1}+${o}`,nonInteraction:!1,ecommerce:{currencyCode:a,click:{actionField:{list:""},products:[{id:i,name:o,price:s,variant:o,position:n+1,brand:"OnePlus",category:""}]}}})})}(!!n.length),clearInterval(o))},500)}function s(e){return e&&0===e.indexOf("501")}function d(e,t){for(;e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}function m(e,t,n){var r=Date.now();n=n||5e3;var a=setInterval(function(){(Date.now()-r>n||e())&&(clearInterval(a),t())},100)}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1}),window.gtmDebug&&(e=n.push,n.push=function(){e.apply(n,arguments)}),"complete"===document.readyState||"loaded"===document.readyState?c():document.addEventListener("DOMContentLoaded",function(){c()})}();
